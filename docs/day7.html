
<!DOCTYPE HTML>
<html lang="ja" >
    <head>
        <meta charset="UTF-8">
        <title>第7回 · oTree 5 勉強会</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.4">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="day8.html" />
    
    
    <link rel="prev" href="day6.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="検索ワードを入力" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    oTree 5 勉強会
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="day1.html">
            
                <a href="day1.html">
            
                    
                    第1回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="day2.html">
            
                <a href="day2.html">
            
                    
                    第2回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="day3.html">
            
                <a href="day3.html">
            
                    
                    第3回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="day4.html">
            
                <a href="day4.html">
            
                    
                    第4回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="day5.html">
            
                <a href="day5.html">
            
                    
                    第5回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="day6.html">
            
                <a href="day6.html">
            
                    
                    第6回
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.7" data-path="day7.html">
            
                <a href="day7.html">
            
                    
                    第7回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="day8.html">
            
                <a href="day8.html">
            
                    
                    第8回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.9" data-path="exercise.html">
            
                <a href="exercise.html">
            
                    
                    演習
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    【資料: 開発編】
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="otree_ref/cmd.html">
            
                <a href="otree_ref/cmd.html">
            
                    
                    シェルで使用するoTreeサブコマンド
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="otree_ref/settings.html">
            
                <a href="otree_ref/settings.html">
            
                    
                    settings.py の書き方
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="otree_ref/init.html">
            
                <a href="otree_ref/init.html">
            
                    
                    __init__.py の書き方
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="otree_ref/templatefile.html">
            
                <a href="otree_ref/templatefile.html">
            
                    
                    テンプレートファイルの書き方
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    【資料: デプロイ編】
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="server_setup/">
            
                <a href="server_setup/">
            
                    
                    Ubuntuで oTree を動かす
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="heroku/">
            
                <a href="heroku/">
            
                    
                    Herokuで oTree を動かす
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    【資料: その他】
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="ubuntu/">
            
                <a href="ubuntu/">
            
                    
                    Ubuntuの仮想環境の構築
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="ubuntu/wsl2.html">
            
                <a href="ubuntu/wsl2.html">
            
                    
                    WSL2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="ubuntu/vagrant.html">
            
                <a href="ubuntu/vagrant.html">
            
                    
                    VirtualBox + Vagrant
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="references/">
            
                <a href="references/">
            
                    
                    参考文献
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            HonKitで公開 
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >第7回</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>【第7回】 2022年6月23日</p>
<ul>
<li>入力フォームの順番をランダム化する</li>
<li>ページの順番をランダム化する</li>
<li>Bootstrapで入力フォームの見た目をモダンにする</li>
</ul>
<h1 id="（qualtricsのような）質問紙調査を作る方法">（Qualtricsのような）質問紙調査を作る方法</h1>
<ul>
<li>今日のゴール<ul>
<li>コード <a href="https://github.com/yshimod/otree_survey" target="_blank">https://github.com/yshimod/otree_survey</a></li>
<li>デモページ <a href="https://otree-seminar-survey-sample.herokuapp.com/demo" target="_blank">https://otree-seminar-survey-sample.herokuapp.com/demo</a></li>
</ul>
</li>
</ul>
<h2 id="1-定数-c-クラスに質問紙調査の「素材」を定義しておく">1. 定数 <code>C</code> クラスに質問紙調査の「素材」を定義しておく</h2>
<ul>
<li>質問文・選択肢・正答などを1箇所にまとめて定義しておいたほうが管理しやすい．</li>
</ul>
<ul>
<li><p>辞書型で定義すると良い．たとえば以下のように CRT と General Trust Scale （以下 Gen Trust ） 用の2つの辞書オブジェクトを定義しておく．</p>
<pre><code class="lang-python"><span class="hljs-comment">## Frederick, S. (2005).</span>
<span class="hljs-comment">## &quot;Cognitive reflection and decision making,&quot;</span>
<span class="hljs-comment">## Journal of Economic perspectives, 19(4), 25-42.</span>
materials_crt = {
    <span class="hljs-string">&quot;field&quot;</span>: models.FloatField,
    <span class="hljs-string">&quot;items&quot;</span>: {
        <span class="hljs-string">&quot;crt1&quot;</span>: {
            <span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;&quot;&quot;
                A bat and a ball cost $1.10 in total.
                The bat costs $1.00 more than the ball.
                How much does the ball cost?
            &quot;&quot;&quot;</span>,
            <span class="hljs-string">&quot;unit&quot;</span>: <span class="hljs-string">&quot;cent(s)&quot;</span>,
            <span class="hljs-string">&quot;correct&quot;</span>: <span class="hljs-number">5.0</span>
        },
        <span class="hljs-string">&quot;crt2&quot;</span>: {
            <span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;&quot;&quot;
                If it takes 5 machines 5 minutes to make 5 widgets,
                how long would it take 100 machines to make 100 widgets?
            &quot;&quot;&quot;</span>,
            <span class="hljs-string">&quot;unit&quot;</span>: <span class="hljs-string">&quot;minute(s)&quot;</span>,
            <span class="hljs-string">&quot;correct&quot;</span>: <span class="hljs-number">5.0</span>
        },
        <span class="hljs-string">&quot;crt3&quot;</span>: {
            <span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;&quot;&quot;
                In a lake, there is a patch of lily pads.
                Every day, the patch doubles in size.
                If it takes 48 days for the patch to cover the entire lake,
                how long would it take for the patch to cover half of the lake?
            &quot;&quot;&quot;</span>,
            <span class="hljs-string">&quot;unit&quot;</span>: <span class="hljs-string">&quot;day(s)&quot;</span>,
            <span class="hljs-string">&quot;correct&quot;</span>: <span class="hljs-number">47</span>
        }
    }
}

<span class="hljs-comment">## Yamagishi, T. &amp; Yamagishi, M. (1994).</span>
<span class="hljs-comment">## &quot;Trust and commitment in the United States and Japan,&quot;</span>
<span class="hljs-comment">## Motivation and Emotion, 18, 129-166.</span>
materials_gentrust = {
    <span class="hljs-string">&quot;field&quot;</span>: models.IntegerField,
    <span class="hljs-string">&quot;opts&quot;</span>: [
        [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Strongly Disagree&quot;</span>],
        [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Disagree&quot;</span>],
        [<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Neutral&quot;</span>],
        [<span class="hljs-number">4</span>, <span class="hljs-string">&quot;Agree&quot;</span>],
        [<span class="hljs-number">5</span>, <span class="hljs-string">&quot;Strongly Agree&quot;</span>]
    ],
    <span class="hljs-string">&quot;items&quot;</span>: {
        <span class="hljs-string">&quot;gentrust1&quot;</span>: <span class="hljs-string">&quot;Most people are basically honest.&quot;</span>,
        <span class="hljs-string">&quot;gentrust2&quot;</span>: <span class="hljs-string">&quot;Most people are trustworthy.&quot;</span>,
        <span class="hljs-string">&quot;gentrust3&quot;</span>: <span class="hljs-string">&quot;Most people are basically good and kind.&quot;</span>,
        <span class="hljs-string">&quot;gentrust4&quot;</span>: <span class="hljs-string">&quot;Most people are trustful of others.&quot;</span>,
        <span class="hljs-string">&quot;gentrust5&quot;</span>: <span class="hljs-string">&quot;I am trustful.&quot;</span>,
        <span class="hljs-string">&quot;gentrust6&quot;</span>: <span class="hljs-string">&quot;Most people will respond in kind when they are trusted by others.&quot;</span>
    }
}
</code></pre>
</li>
</ul>
<ul>
<li><p>Python で辞書型のオブジェクトを定義するには，JSONのように <code>{ }</code> の中に記述するか， <code>dict()</code> を使って記述しても良い．以下の2つは等価．</p>
<pre><code class="lang-python">year = <span class="hljs-number">2022</span>
mydict1 = {
    <span class="hljs-string">&quot;year&quot;</span>: year,
    <span class="hljs-string">&quot;key1&quot;</span>: <span class="hljs-string">&quot;あいうえお&quot;</span>
}
</code></pre>
<pre><code class="lang-python">year = <span class="hljs-number">2022</span>
mydict2 = <span class="hljs-built_in">dict</span>(
    year = year,
    key1 = <span class="hljs-string">&quot;あいうえお&quot;</span>
)
</code></pre>
<pre><code class="lang-python">mydict1 == mydict2
<span class="hljs-comment"># True</span>
</code></pre>
</li>
</ul>
<ul>
<li>辞書オブジェクトから値を取り出すときは <code>辞書[&quot;キー&quot;]</code> とする．たとえば，コード例の <code>crt1</code> の質問文を取り出すには， <code>C.materials_crt[&quot;items&quot;][&quot;crt1&quot;][&quot;question&quot;]</code> とする．</li>
</ul>
<ul>
<li><p>辞書オブジェクトからキーの一覧を取得するには， <code>.keys()</code> メソッドを使う．たとえばキーを一つずつ <code>print</code> するには，</p>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys():
    <span class="hljs-built_in">print</span>(k)
<span class="hljs-comment"># crt1</span>
<span class="hljs-comment"># crt2</span>
<span class="hljs-comment"># crt3</span>
</code></pre>
<ul>
<li><p><code>辞書.keys()</code> はリストではない（ dict_keys オブジェクトである）ため， <code>辞書.keys()[0]</code> として0番目のキーを取り出す，ということはできない．</p>
</li>
<li><p>リストに変換するためには， <code>辞書.keys()</code> をアンパックすれば良い．つまり <code>[*辞書.keys()]</code> とすればキーの文字列が並んだリストが得られる．</p>
<ul>
<li>アンパック以外に， <code>list()</code> 関数を使う（ <code>list(辞書.keys())</code> ），内包表記を使う（ <code>[k for k in 辞書.keys()]</code> ）方法があるが，アンパックを使った方が処理が速い．</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>辞書オブジェクトからキーと対応する値の両方を取得するには， <code>.items()</code> メソッドを使う．たとえばキーと値の組を一つずつ <code>print</code> するには，</p>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>].items():
    <span class="hljs-built_in">print</span>(k + <span class="hljs-string">&quot; の値は &quot;</span> + v)
<span class="hljs-comment"># gentrust1 の値は Most people are basically honest.</span>
<span class="hljs-comment"># gentrust2 の値は Most people are trustworthy.</span>
<span class="hljs-comment"># gentrust3 の値は Most people are basically good and kind.</span>
<span class="hljs-comment"># gentrust4 の値は Most people are trustful of others.</span>
<span class="hljs-comment"># gentrust5 の値は I am trustful.</span>
<span class="hljs-comment"># gentrust6 の値は Most people will respond in kind when they are trusted by others.</span>
</code></pre>
<ul>
<li><code>辞書.items()</code> をリストに変換したとき，タプルにキーと値が入った状態でリストの要素になっている．</li>
</ul>
</li>
</ul>
<ul>
<li><p>値として関数自体を入れることもできる．たとえば <code>C.materials_crt[&quot;field&quot;]</code> の値は関数 <code>models.FloatField</code> であり，以下の2つは等価である．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
    testvar1 = models.FloatField(label = <span class="hljs-string">&quot;入力してください．&quot;</span>)
</code></pre>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
    testvar1 = C.materials_crt[<span class="hljs-string">&quot;field&quot;</span>](label = <span class="hljs-string">&quot;入力してください．&quot;</span>)
</code></pre>
</li>
</ul>
<ul>
<li><p>質問文など長文を定義するとき，三重引用符 <code>&quot;&quot;&quot; &quot;&quot;&quot;</code> で括れば途中に改行を入れても良い．文字列には改行文字（ <code>\n</code> ）やインデント用に入れてある空白文字がそのまま入る．たとえば <code>C.materials_crt[&quot;items&quot;][&quot;crt1&quot;][&quot;question&quot;]</code> は以下が返ってくる．</p>
<pre><code>&apos;\n                A bat and a ball cost $1.10 in total.\n                The bat costs $1.00 more than the ball.\n                How much does the ball cost?\n            &apos;
</code></pre><ul>
<li><p>ただし，その文字列がテンプレートで展開されるときには改行文字は空白文字に置換され，連続した空白文字は無視される．</p>
</li>
<li><p>改行したい場合には <code>&lt;br&gt;</code> や <code>&lt;p&gt;</code> のタグを使用した上で，テンプレートにおいてこれらのタグが機能する形で文字列を展開する必要がある．</p>
<ul>
<li>データモデルのクラスで <code>var1 = models.IntegerField(label=&quot;ここで&lt;br&gt;改行&quot;)</code> と定義した上で <code>{{ formfields }}</code> タグで入力フォームを実装したとき HTML タグ（たとえば <code>&lt;br&gt;</code> タグ）は機能しない．何となれば， <code>label</code> に渡した文字列が HTML に展開されるとき，HTMLセーフな文字列（ <code>ここで&lt;br&gt;改行</code> は <code>ここで&amp;lt;br&amp;gt;改行</code> ）に変換された上で <code>&lt;label&gt;</code> 要素として展開されるため．</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-データモデルでたくさんのフィールドを定義する">2. データモデルでたくさんのフィールドを定義する</h2>
<ul>
<li><p><a href="https://otree.readthedocs.io/en/latest/misc/tips_and_tricks.html#how-to-make-many-fields" target="_blank">https://otree.readthedocs.io/en/latest/misc/tips_and_tricks.html#how-to-make-many-fields</a></p>
</li>
<li><p>自分の手で一つずつ定義すると以下のようにする．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
    crt1 = models.FloatField(
        label = C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;crt1&quot;</span>][<span class="hljs-string">&quot;question&quot;</span>],
        help_text = C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;crt1&quot;</span>][<span class="hljs-string">&quot;unit&quot;</span>]
    )
    crt2 = models.FloatField(
        label = C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;crt2&quot;</span>][<span class="hljs-string">&quot;question&quot;</span>],
        help_text = C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;crt2&quot;</span>][<span class="hljs-string">&quot;unit&quot;</span>]
    )
    crt3 = models.FloatField(
        label = C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;crt3&quot;</span>][<span class="hljs-string">&quot;question&quot;</span>],
        help_text = C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;crt3&quot;</span>][<span class="hljs-string">&quot;unit&quot;</span>]
    )
    gentrust1 = models.IntegerField(
        label = C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;gentrust1&quot;</span>],
        choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
        widget = widgets.RadioSelectHorizontal
    )
    gentrust2 = models.IntegerField(
        label = C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;gentrust2&quot;</span>],
        choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
        widget = widgets.RadioSelectHorizontal
    )
    gentrust3 = models.IntegerField(
        label = C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;gentrust3&quot;</span>],
        choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
        widget = widgets.RadioSelectHorizontal
    )
    gentrust4 = models.IntegerField(
        label = C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;gentrust4&quot;</span>],
        choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
        widget = widgets.RadioSelectHorizontal
    )
    gentrust5 = models.IntegerField(
        label = C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;gentrust5&quot;</span>],
        choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
        widget = widgets.RadioSelectHorizontal
    )
    gentrust6 = models.IntegerField(
        label = C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-string">&quot;gentrust6&quot;</span>],
        choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
        widget = widgets.RadioSelectHorizontal
    )
</code></pre>
<ul>
<li>自分の手でコピペしてループするのは危険．うっかりミスをしがち．たとえ，自分は几帳面である，と思っている人であっても．</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>Player</code> クラスの外側（下側）で， <code>setattr(Player, &quot;フィールド名&quot;, models.*Field())</code> をforループで回す．以下の記述は，上で一つずつ定義しているのと同じ．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].items():
    <span class="hljs-built_in">setattr</span>(
        Player,
        k,
        C.materials_crt[<span class="hljs-string">&quot;field&quot;</span>](
            label = v[<span class="hljs-string">&quot;question&quot;</span>],
            help_text = v[<span class="hljs-string">&quot;unit&quot;</span>]
        )
    )

<span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>].items():
    <span class="hljs-built_in">setattr</span>(
        Player,
        k,
        C.materials_gentrust[<span class="hljs-string">&quot;field&quot;</span>](
            label = v,
            choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
            widget = widgets.RadioSelectHorizontal
        )
    )
</code></pre>
<ul>
<li><p>Python の組み込み関数 <code>setattr()</code> は，第2引数の文字列の名前の変数に，第3引数の値を代入したものを，第1引数のオブジェクト（たとえば <code>Player</code> クラス）に追加する．以下の2つは等価である．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
  testvar1 = models.FloatField(label = <span class="hljs-string">&quot;入力してください．&quot;</span>)
</code></pre>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
  <span class="hljs-keyword">pass</span>

<span class="hljs-built_in">setattr</span>(
  Player,    <span class="hljs-comment">## 既に定義してあるクラスオブジェクト</span>
  <span class="hljs-string">&quot;testvar1&quot;</span>,    <span class="hljs-comment">## 文字列</span>
  models.FloatField(label = <span class="hljs-string">&quot;入力してください．&quot;</span>)
)
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="3-入力フォームの順番をランダム化する">3. 入力フォームの順番をランダム化する</h2>
<ul>
<li><a href="https://otree.readthedocs.io/en/latest/forms.html#customizing-a-field-s-appearance" target="_blank">https://otree.readthedocs.io/en/latest/forms.html#customizing-a-field-s-appearance</a></li>
</ul>
<ul>
<li><p>テンプレートで <code>{{ formfields }}</code> タグなどを使って入力フォームを作るとき，入力フォームの順番は，ページクラスの <code>form_fields</code> に渡したリストの順番となる． <code>get_form_fields()</code> を定義した場合はその返り値のリストの順番が優先される．</p>
<ul>
<li><p>たとえば</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey1</span>(<span class="hljs-params">Page</span>):</span>
  form_model = <span class="hljs-string">&quot;player&quot;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> [<span class="hljs-string">&quot;crt1&quot;</span>, <span class="hljs-string">&quot;crt3&quot;</span>, <span class="hljs-string">&quot;crt2&quot;</span>]
</code></pre>
<p>なるページを定義した上で，テンプレートで <code>{{ formfields }}</code> を使ったとき， &quot;crt1&quot;， &quot;crt3&quot;， &quot;crt2&quot; の順番で入力フォームが生成される．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mb-3 _formfield&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-form-label&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_crt1&quot;</span>&gt;</span>
      A bat and a ball cost $1.10 in total.
      The bat costs $1.00 more than the ball.
      How much does the ball cost?
  <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;controls&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_crt1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;crt1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span>cent(s)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mb-3 _formfield&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-form-label&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_crt3&quot;</span>&gt;</span>
      In a lake, there is a patch of lily pads.
      Every day, the patch doubles in size.
      If it takes 48 days for the patch to cover the entire lake,
      how long would it take for the patch to cover half of the lake?
  <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;controls&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_crt3&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;crt3&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span>day(s)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mb-3 _formfield&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-form-label&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_crt2&quot;</span>&gt;</span>
      If it takes 5 machines 5 minutes to make 5 widgets,
      how long would it take 100 machines to make 100 widgets?
  <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;controls&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_crt2&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;crt2&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-text text-muted&quot;</span>&gt;</span>minute(s)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
<li><p><code>{{ for }}</code> ループを使って，テンプレートを</p>
<pre><code class="lang-html">{{ for eachfield in form }}
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>label: {{ eachfield.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>name: {{ eachfield.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>id: {{ eachfield.id }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>description: {{ eachfield.description }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{{ endfor }}
</code></pre>
<p>のように記述したとき，以下の HTML が生成される．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>label:
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_crt1&quot;</span>&gt;</span>
          A bat and a ball cost $1.10 in total.
          The bat costs $1.00 more than the ball.
          How much does the ball cost?
      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>name: crt1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>id: id_crt1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>description: cent(s)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>label:
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_crt3&quot;</span>&gt;</span>
          In a lake, there is a patch of lily pads.
          Every day, the patch doubles in size.
          If it takes 48 days for the patch to cover the entire lake,
          how long would it take for the patch to cover half of the lake?
      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>name: crt3<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>id: id_crt3<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>description: day(s)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>label:
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_crt2&quot;</span>&gt;</span>
          If it takes 5 machines 5 minutes to make 5 widgets,
          how long would it take 100 machines to make 100 widgets?
      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>name: crt2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>id: id_crt2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>description: minute(s)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li>詳細は <a href="otree_ref/templatefile.html#form-オブジェクト">こちら</a> ．</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><code>{{ formfields }}</code> タグなどを使って入力フォームを作るとき，ページクラスの <code>get_form_fields()</code> で， player ごとシャッフルされたフィールド名のリストを返せば， player ごと入力フォームの順番をランダム化できる．</li>
</ul>
<ul>
<li><p>乱数を引く処理を行う場合，乱数は一度だけ引き，その結果を記録しておくと良い．たとえば， <code>creating_session()</code> の中でリストを並び替え，その結果を <code>json.dumps()</code> を使って文字列に変換し， player モデルのフィールド（ <code>order_crt = models.LongStringField()</code> と定義してある）に記録しておく．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import random</span>
<span class="hljs-comment"># import json</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">creating_session</span>(<span class="hljs-params">subsession: Subsession</span>):</span>
    list_crt = [*C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys()]    <span class="hljs-comment">## フィールド名（文字列）のリスト</span>

    <span class="hljs-comment">## 全ての player について乱数を引いて結果を保存しておく</span>
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> subsession.get_players():
        new_list_crt = random.sample(list_crt, <span class="hljs-built_in">len</span>(list_crt))
        p.order_crt = json.dumps(new_list_crt)
</code></pre>
<ul>
<li><p><code>json.dumps()</code> は，辞書型やリスト型のオブジェクトを（JSON）文字列にエンコード（変換）する関数．その逆で，（JSONの）文字列を Python が 辞書型やリスト型のオブジェクトとして使えるようにデコードする関数は <code>json.loads()</code>．以下の操作を確認せよ．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import json</span>
list_crt = [<span class="hljs-string">&quot;crt1&quot;</span>, <span class="hljs-string">&quot;crt2&quot;</span>, <span class="hljs-string">&quot;crt3&quot;</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(list_crt))
<span class="hljs-comment"># &lt;class &apos;list&apos;&gt;</span>
<span class="hljs-built_in">print</span>(list_crt[<span class="hljs-number">0</span>])
<span class="hljs-comment"># crt1</span>

encoded_list_crt = json.dumps(list_crt)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(encoded_list_crt))
<span class="hljs-comment"># &lt;class &apos;str&apos;&gt;</span>
<span class="hljs-built_in">print</span>(encoded_list_crt)
<span class="hljs-comment"># [&quot;crt1&quot;, &quot;crt2&quot;, &quot;crt3&quot;]</span>
<span class="hljs-built_in">print</span>(encoded_list_crt[<span class="hljs-number">0</span>])
<span class="hljs-comment"># [</span>

decoded_list_crt = json.loads(encoded_list_crt)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(decoded_list_crt))
<span class="hljs-comment"># &lt;class &apos;list&apos;&gt;</span>
<span class="hljs-built_in">print</span>(list_crt == decoded_list_crt)
<span class="hljs-comment"># True</span>
</code></pre>
<pre><code class="lang-python">testdict = <span class="hljs-built_in">dict</span>(
  testsublist = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>],
  testsubdict = <span class="hljs-built_in">dict</span>(
      k1 = <span class="hljs-number">1</span>
  )
)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(testdict))
<span class="hljs-comment"># &lt;class &apos;dict&apos;&gt;</span>

encoded_testdict = json.dumps(testdict)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(encoded_testdict))
<span class="hljs-comment"># &lt;class &apos;str&apos;&gt;</span>
<span class="hljs-built_in">print</span>(encoded_testdict)
<span class="hljs-comment"># {&quot;testsublist&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], &quot;testsubdict&quot;: {&quot;k1&quot;: 1}}</span>

decoded_testdict = json.loads(encoded_testdict)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(decoded_testdict))
<span class="hljs-comment"># &lt;class &apos;dict&apos;&gt;</span>
<span class="hljs-built_in">print</span>(testdict == decoded_testdict)
<span class="hljs-comment"># True</span>
</code></pre>
</li>
<li><p>文字列に変換せず，リストオブジェクトのままデータを記録しようとする（たとえば <code>p.order_crt = new_list_crt</code> ）とエラーとなる．</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>get_form_fields()</code> において，文字列として記録してあるフィールド名のリストを <code>json.loads()</code> でパース（Pythonがリストとして扱えるように変換）してから返す．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import json</span>
<span class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
    <span class="hljs-keyword">return</span> json.loads(player.order_crt)
</code></pre>
</li>
</ul>
<ul>
<li><p>入力フォームの順番をランダム化するには，直接 <code>get_form_fields()</code> の中で乱数を引いてリストの要素を並び替えたものを返しても良さそう．たとえば以下のような実装が考えられる（が，おすすめできない）．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import random</span>
<span class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
    list_crt = [*C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys()]
    new_list_crt = random.sample(list_crt, <span class="hljs-built_in">len</span>(list_crt))

    <span class="hljs-keyword">return</span> new_list_crt
</code></pre>
<ul>
<li><code>get_form_fields()</code> はページを読み込む度に実行されるため，↑ の実装だと，画面を更新する度に入力フォームの順番が並び替えられてしまう．</li>
</ul>
</li>
</ul>
<ul>
<li><p>セッション作成時に呼び出される <code>creating_session()</code> ではなく，どうしても <code>get_form_fields()</code> の中で乱数を引きたい場合，結果が記録されていない場合（ <code>player.field_maybe_none(&quot;order_crt&quot;) == None</code> ）にのみ乱数を引くような実装にしたほうが良い．たとえば以下のような実装をする．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import random</span>
<span class="hljs-comment"># import json</span>
<span class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
    <span class="hljs-keyword">if</span> player.field_maybe_none(<span class="hljs-string">&quot;order_crt&quot;</span>) == <span class="hljs-literal">None</span>:
        list_crt = [*C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys()]
        new_list_crt = random.sample(list_crt, <span class="hljs-built_in">len</span>(list_crt))
        player.order_crt = json.dumps(new_list_crt)

    <span class="hljs-keyword">return</span> json.loads(player.order_crt)
</code></pre>
<ul>
<li>フィールドの中身が <code>None</code> か否かを判定するときに直接 <code>player.order_crt == None</code> として比較すると，（本当に <code>None</code> の場合）エラーとなるので，組み込みメソッド <code>.field_maybe_none()</code> を使う．</li>
</ul>
</li>
</ul>
<h2 id="4-ページの順番をランダム化する">4. ページの順番をランダム化する</h2>
<ul>
<li><p>複数ページ（ここでは CRT 用のページと Gen Trust 用のページ）で共通して使うテンプレートファイル（たとえば <code>survey_template.html</code> ）を作成する．</p>
<ul>
<li><p>たとえば以下のような記述であれば，ページの内容（ CRT か Gen Trust か ）によらずテンプレートを共通化できる．</p>
<pre><code class="lang-html">{{ block title }}
  アンケートにご回答ください
{{ endblock }}

{{ block content }}
  {{ formfields }}
  {{ next_button }}
{{ endblock }}
</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>入力フォームを <code>{{ formfields }}</code> タグ（のみ）を使って実装している場合，当該ページで表示させたい入力フォームのフィールド名のリストを <code>get_form_fields()</code> で返せば良い．</p>
<ul>
<li><p>まず，ページの順番のリストを <code>creating_session()</code> の中で乱数を引いて決定する．なお，あらかじめ順番を記録しておくフィールド <code>order_pages</code>， <code>order_crt</code>， <code>order_gentrust</code> を <code>models.LongStringField</code> で定義しておく．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import random</span>
<span class="hljs-comment"># import json</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">creating_session</span>(<span class="hljs-params">subsession: Subsession</span>):</span>
  list_crt = [*C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys()]
  list_gentrust = [*C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>].keys()]

  <span class="hljs-comment">## 全ての player について乱数を引いた結果を保存しておく</span>
  <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> subsession.get_players():
      list_pages = [<span class="hljs-string">&quot;crt&quot;</span>, <span class="hljs-string">&quot;gentrust&quot;</span>]
      new_list_pages = random.sample(list_pages, <span class="hljs-built_in">len</span>(list_pages))
      p.order_pages = json.dumps(new_list_pages)
      <span class="hljs-comment">## ↑ 文字列 &quot;crt&quot; と &quot;gentrust&quot; が入ったリスト．</span>
      <span class="hljs-comment">## 0番目の要素には，1ページ目（Survey1）で表示させたいもの，</span>
      <span class="hljs-comment">## 1番目の要素には，2ページ目（Survey2）で表示させたいもの，が入っている．</span>

      list_crt = [*C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys()]
      new_list_crt = random.sample(list_crt, <span class="hljs-built_in">len</span>(list_crt))
      p.order_crt = new_list_crt

      list_gentrust = [*C.materials_crt[<span class="hljs-string">&quot;items&quot;</span>].keys()]
      new_list_gentrust = random.sample(list_gentrust, <span class="hljs-built_in">len</span>(list_gentrust))
      p.order_gentrust = json.dumps(new_list_gentrust)
</code></pre>
</li>
<li><p>各ページのクラスで定義する <code>get_form_fields()</code> を，共通化するために，ページクラスの外側で，自前の関数として以下を定義する．たとえば関数名を <code>my_get_form_fields</code> としている．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import json</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_get_form_fields</span>(<span class="hljs-params">player: Player, idx</span>):</span>
  order_pages = json.loads(player.order_pages)

  <span class="hljs-keyword">if</span> order_pages[idx] == <span class="hljs-string">&quot;crt&quot;</span>:
      <span class="hljs-comment">## もしも order_pages の idx 番目の要素が &quot;crt&quot; の場合...</span>
      <span class="hljs-keyword">return</span> json.loads(player.order_crt)    <span class="hljs-comment">## [&quot;crt1&quot;, &quot;crt2&quot;, &quot;crt3&quot;] （を並び替えたもの）を返す．</span>
  <span class="hljs-keyword">else</span>:
      <span class="hljs-comment">## もしも order_pages の idx 番目の要素が &quot;gentrust&quot; の場合...</span>
      <span class="hljs-keyword">return</span> json.loads(player.order_gentrust)    <span class="hljs-comment">## [&quot;gentrust1&quot;, &quot;gentrust2&quot;, ..., &quot;gentrust6&quot;] （を並び替えたもの）を返す．</span>
</code></pre>
<ul>
<li>第2引数 <code>idx</code> には，当該ページが何ページ目なのかを判断するための変数を受け取っている．</li>
</ul>
</li>
<li><p>各ページクラスを定義する．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey1</span>(<span class="hljs-params">Page</span>):</span>
  template_name = __name__ + <span class="hljs-string">&quot;/survey_template.html&quot;</span>
  form_model = <span class="hljs-string">&quot;player&quot;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> my_get_form_fields(player, <span class="hljs-number">0</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey2</span>(<span class="hljs-params">Page</span>):</span>
  template_name = __name__ + <span class="hljs-string">&quot;/survey_template.html&quot;</span>
  form_model = <span class="hljs-string">&quot;player&quot;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> my_get_form_fields(player, <span class="hljs-number">1</span>)
</code></pre>
<ul>
<li><p><code>template_name</code> にテンプレートファイルのパスを渡せば，共通のテンプレートファイルを異なるページで読み込むように設定できる．</p>
<ul>
<li><code>__name__</code> はアプリ名を呼び出している．「survey」なるアプリであれば， <code>__name__ + &quot;/survey_template.html&quot;</code> は <code>&quot;survey/survey_template.html&quot;</code> と等価．</li>
</ul>
</li>
<li><p>各ページのクラスで，自前の関数 <code>my_get_form_fields()</code> を組み込みメソッド <code>get_form_fields()</code> の中で呼び出す．</p>
</li>
<li><p>ページクラスの名前（ <code>&quot;Survey1&quot;</code>， <code>&quot;Survey2&quot;</code> ）の末尾の数字を取り出したい場合...</p>
<ul>
<li><p>たとえば <code>Survey1</code> クラスの中で <code>__class__.__name__</code> で文字列 <code>&quot;Survey1&quot;</code> が取得できるので， <code>int(__class__.__name__[-1]) - 1</code> は <code>0</code> である．</p>
</li>
<li><p>ページクラスの外側で，ページクラスの名前を取得するには， <code>participant._current_page_name</code> を使えば良い．呼び出された段階でその participant が滞在しているページのクラスの名前が取得できる．</p>
</li>
</ul>
</li>
<li><p><code>Survey1</code> クラスと <code>Survey2</code> クラスでほとんど同じことを書いているので，クラスの継承を使ってもう少し簡略化した記述も可能．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SurveyCommon</span>(<span class="hljs-params">Page</span>):</span>
  template_name = __name__ + <span class="hljs-string">&quot;/survey_template.html&quot;</span>
  form_model = <span class="hljs-string">&quot;player&quot;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
      idx = <span class="hljs-built_in">int</span>(player.participant._current_page_name[-<span class="hljs-number">1</span>]) - <span class="hljs-number">1</span>
      <span class="hljs-keyword">return</span> my_get_form_fields(player, idx)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey1</span>(<span class="hljs-params">SurveyCommon</span>):</span>
  <span class="hljs-keyword">pass</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey2</span>(<span class="hljs-params">SurveyCommon</span>):</span>
  <span class="hljs-keyword">pass</span>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ページ別にテンプレートファイルを分けている場合（たとえば CRT 用に <code>crt.html</code>， Gen Trust 用に <code>gentrust.html</code> ），共通のテンプレートにおいて読み込むテンプレートファイルを切り替える．</p>
<ul>
<li><p>ページクラスの <code>vars_for_template()</code> メソッドで，当該ページで CRT を表示するのか Gen Trust を表示するのかの情報（テンプレートファイルのパスやフラグの文字列など）をテンプレートに渡す．</p>
<pre><code class="lang-python"><span class="hljs-comment"># import json</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_pagename</span>(<span class="hljs-params">player: Player, idx</span>):</span>
  order_pages = json.loads(player.order_pages)
  page_name =  order_pages[idx]
  <span class="hljs-keyword">return</span> page_name

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_get_form_fields</span>(<span class="hljs-params">player: Player, idx</span>):</span>
  page_name = get_pagename(player, idx)
  <span class="hljs-keyword">if</span> page_name == <span class="hljs-string">&quot;crt&quot;</span>:
      <span class="hljs-keyword">return</span> json.loads(player.order_crt)
  <span class="hljs-keyword">else</span>:
      <span class="hljs-keyword">return</span> json.loads(player.order_gentrust)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_vars_for_template</span>(<span class="hljs-params">player: Player, idx</span>):</span>
  page_name = get_pagename(player, idx)
  <span class="hljs-keyword">if</span> page_name == <span class="hljs-string">&quot;crt&quot;</span>:
      page_path = __name__ + <span class="hljs-string">&quot;/crt.html&quot;</span>
  <span class="hljs-keyword">else</span>:
      page_path = __name__ + <span class="hljs-string">&quot;/gentrust.html&quot;</span>

  <span class="hljs-keyword">return</span> {
      <span class="hljs-string">&quot;page_num&quot;</span>: idx + <span class="hljs-number">1</span>,    <span class="hljs-comment">## 数値 1 または 2</span>
      <span class="hljs-string">&quot;page_name&quot;</span>: page_name,    <span class="hljs-comment">## 文字列 &quot;crt&quot; または &quot;gentrust&quot;</span>
      <span class="hljs-string">&quot;page_path&quot;</span>: page_path    <span class="hljs-comment">## 文字列 &quot;アプリ名/crt.html&quot; または &quot;アプリ名/gentrust.html&quot;</span>
  }

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey1</span>(<span class="hljs-params">Page</span>):</span>
  template_name = __name__ + <span class="hljs-string">&quot;/survey_template.html&quot;</span>
  form_model = <span class="hljs-string">&quot;player&quot;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> my_get_form_fields(player, <span class="hljs-number">0</span>)

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">vars_for_template</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> my_vars_for_template(player, <span class="hljs-number">0</span>)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey2</span>(<span class="hljs-params">Page</span>):</span>
  template_name = __name__ + <span class="hljs-string">&quot;/survey_template.html&quot;</span>
  form_model = <span class="hljs-string">&quot;player&quot;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_form_fields</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> my_get_form_fields(player, <span class="hljs-number">1</span>)

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">vars_for_template</span>(<span class="hljs-params">player: Player</span>):</span>
      <span class="hljs-keyword">return</span> my_vars_for_template(player, <span class="hljs-number">1</span>)
</code></pre>
</li>
<li><p>共通で使うテンプレートファイル <code>survey_template.html</code> は，たとえば以下のように記述する．</p>
<pre><code class="lang-html">{{ block title }}
  アンケートにご回答ください （ {{ page_num }} / 2 ページ ）
{{ endblock }}

{{ block content }}

  {# ↓ vars_for_template() で定義した変数 page_name で条件分岐 #}
  {{ if page_name == &quot;crt&quot; }}
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>以下の CRT の質問に回答してください．<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  {{ else }}
       <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>以下の Gen Trust の質問に回答してください．<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  {{ endif }}

  {# ↓ vars_for_template() で定義した変数（ファイルパス） page_path によって crt.html または gentrust.html が展開される #}
  {{ include page_path }}

  {{ next_button }}

{{ endblock }}
</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>（余談） ↑ では，<code>{{ include }}</code> する子テンプレートファイルを切り替えるために， <code>vars_for_template()</code> でテンプレートファイルのパスを親テンプレートに渡していた．ページクラスで読み込む親テンプレートファイル（ <code>{{ block title }}</code> や <code>{{ block content }}</code> が含まれるテンプレート）自体も player ごと切り替えるために，ちょうど <code>form_fields</code> に渡したリストを <code>get_form_fields()</code> で上書きしたように， <code>template_name</code> に渡したパスを <code>get_template_name()</code> みたいな関数で上書きできたら便利かもしれない．公式ドキュメントで「 get_template_name 」を検索しても出てこないのだが，実のところ，ページクラスのメソッド <code>get_template_name()</code> は存在していて，我々がページクラスを定義する際に継承している親クラス（ <code>Page</code> クラス）において以下のように定義されている．</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_template_name</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-keyword">if</span> self.template_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> self.template_name
    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;{}/{}.html&apos;</span>.<span class="hljs-built_in">format</span>(
        get_app_label_from_import_path(self.__module__), self.__class__.__name__
    )
</code></pre>
<p>  これを，自らが定義する（ <code>Page</code> クラスを継承した）クラスにおいてオーバーライドしてしまえば，望んだ使い方ができるかもしれない．注意点は， oTree 本体ではスタティックメソッドとして定義されておらず，第1引数には <code>self</code> を受け取っている点である．したがって，自分でオーバーライドする際にも第1引数には <code>self</code> を取り， <code>player</code> オブジェクトを使いたい場合は <code>self.player</code> とすれば良い．たとえば，以下のような実装が可能かもしれない．</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey1</span>(<span class="hljs-params">Page</span>):</span>
    form_model = <span class="hljs-string">&quot;player&quot;</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_template_name</span>(<span class="hljs-params">self</span>):</span>
        player = self.player
        idx = <span class="hljs-number">0</span>
        page_name = json.loads(player.order_pages)[idx]

        <span class="hljs-keyword">if</span> page_name == <span class="hljs-string">&quot;crt&quot;</span>:
            <span class="hljs-keyword">return</span> __name__ + <span class="hljs-string">&quot;/Crt.html&quot;</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> __name__ + <span class="hljs-string">&quot;/GenTrust.html&quot;</span>
</code></pre>
</li>
</ul>
<p class="ytubevideo"><iframe width="560" height="315" src="https://www.youtube.com/embed/hvYpAj7eA_0?rel=0&amp;enablejsapi=1&amp;origin=https://yshimod.github.io/" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>


<ul>
<li>勉強会当日の説明が不十分だったのと，しゃべりながらより賢い方法に気づいたのもあり，動画でのコードの書き方とこのページでの説明は一部異なっています．</li>
</ul>
<ul>
<li><p>要点は以下．</p>
<ul>
<li><p><code>{{ formfields }}</code> を使うとき，どの入力フォームがどの順番で生成されるのかは <code>get_form_fields()</code> が返すリストに従う．したがって，リストの中身を player ごと，あるいはページの順番ごと変化させることによって入力フォームの順番やページの順番をランダム化できる．</p>
</li>
<li><p><code>{{ formfields }}</code> を使わずに画面の内容を player ごと，あるいはページの順番ごと，変化させたい場合，素材を <code>vars_for_template()</code> を使ってテンプレートに渡せば良い．</p>
</li>
<li><p>乱数を引く場合には，一度だけ乱数を引いてその結果を記録しておく．リスト型の場合は JSON 文字列に変換してから記録すれば良い．</p>
</li>
<li><p>ページの順番をシャッフルしたい場合，ページクラスを定義するときにはページの内容に依存しないように記述しなければならない．したがって，テンプレートファイルは共通化したものを最低限用意して，その中でテンプレートタグを使って内容を変化させるように実装すれば良い．またページクラスの組み込みメソッドは，インデックスで挙動を変えるような関数を自前であらかじめ定義しておき，それを呼び出すように実装すれば良い．</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>自分が今処理しようとしているオブジェクト（リストや辞書）がどういうものか分からなくなったとき，その箇所で <code>print</code> してみると良いでしょう．</li>
</ul>
<ul>
<li>組み込み関数・メソッドの返り値の型（リストを返すのか，辞書を返すのか）が分からないとき，公式ドキュメントを検索するか， <a href="otree_ref/init.html"><code>__init__.py</code> の書き方</a> を参照して確認してください．</li>
</ul>
<h2 id="5-見た目をかっこよくする">5. 見た目をかっこよくする</h2>
<h3 id="css">CSS</h3>
<ul>
<li>テンプレートで <code>{{ formfields }}</code> タグを使って入力フォームを作ると，あまりにもデザインがダサく辟易してしまう．</li>
</ul>
<ul>
<li><p>CSS を指定してスタイルを変更する．</p>
<ul>
<li><a href="https://otree.readthedocs.io/en/latest/templates.html#javascript-and-css" target="_blank">https://otree.readthedocs.io/en/latest/templates.html#javascript-and-css</a></li>
</ul>
</li>
</ul>
<ul>
<li><p>CSS を指定するには，以下の3通り．</p>
<ul>
<li><p>テンプレートファイルの HTML タグに <code>style</code> 属性を加える．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-weight: bold;&quot;</span>&gt;</span>以下の質問にご回答ください．<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
</li>
<li><p>テンプレートファイルに <code>{{ block styles }} {{ endblock }}</code> を置き，その中に<code>&lt;style&gt;</code> タグで CSS を書く．</p>
<pre><code class="lang-html">{{ block title }}
  タイトル
{{ endblock }}

{{ block styles }}
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="css">
      <span class="hljs-selector-class">.mypstyle</span>{
          <span class="hljs-attribute">font-weight</span>: bold;
      }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
{{ endblock }}

{{ block content }}
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mypstyle&quot;</span>&gt;</span>以下の質問にご回答ください．<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  {{ formfields }}
  {{ next_button }}
{{ endblock }}
</code></pre>
<ul>
<li><code>{{ block content }} {{ endblock }}</code> の中に直接 <code>&lt;style&gt;</code> タグを書いても良い．ただし読み込まれる順番が遅くなる．</li>
</ul>
</li>
<li><p>CSS ファイル（ <code>mystyles.css</code> ）を作成して， <code>_static/global</code> などに入れておき，それを読み込む．</p>
<pre><code class="lang-html">{{ block title }}
  タイトル
{{ endblock }}

{{ block styles }}
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;{{ static &apos;global/mystyles.css&apos; }}&quot;</span>&gt;</span>
{{ endblock }}

{{ block content }}
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mypstyle&quot;</span>&gt;</span>以下の質問にご回答ください．<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  {{ formfields }}
  {{ next_button }}
{{ endblock }}
</code></pre>
<p>CSS ファイル <code>mystyles.css</code> の中身は以下．</p>
<pre><code class="lang-css"><span class="hljs-selector-class">.mypstyle</span>{
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ブラウザで HTML の要素を検証し， oTree 組み込みの CSS セレクタを見つけ，それをカスタマイズすれば良い．</p>
<ul>
<li><p><a href="https://otree.readthedocs.io/en/latest/templates.html#customizing-the-theme" target="_blank">https://otree.readthedocs.io/en/latest/templates.html#customizing-the-theme</a></p>
</li>
<li><p>たとえば「次へ」ボタンを右寄せにしたい場合，以下のように CSS を設定する．</p>
<pre><code class="lang-css"><span class="hljs-selector-class">.otree-btn-next</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> auto;
}
</code></pre>
</li>
</ul>
</li>
</ul>
<p class="ytubevideo"><iframe width="560" height="315" src="https://www.youtube.com/embed/tX7Twpkillk?rel=0&amp;enablejsapi=1&amp;origin=https://yshimod.github.io/" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>



<h3 id="bootstrap">Bootstrap</h3>
<ul>
<li><p>oTree ではデフォルトで Bootstrap が読み込まれているので，使用することができる．</p>
<ul>
<li><p><a href="https://getbootstrap.com/docs/5.0/getting-started/introduction/" target="_blank">Bootstrap のドキュメント</a></p>
</li>
<li><p>Bootstrap のバージョンは 5.0.1 （oTree v5.8.5 において）．</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>デフォルトで読み込まれているので，自分で CDN などを読み込んではいけない．異なるバージョンを使うことはできない（？）．</li>
</ul>
<ul>
<li>基本的には HTML タグの <code>class</code> に Bootstrap が定義するクラス名を記述すれば良い．</li>
</ul>
<h4 id="ラジオボタンを-bootstrap-の-button-group-で実装してみる">ラジオボタンを Bootstrap の Button group で実装してみる</h4>
<ul>
<li><a href="https://getbootstrap.com/docs/5.0/components/button-group/#checkbox-and-radio-button-groups" target="_blank">https://getbootstrap.com/docs/5.0/components/button-group/#checkbox-and-radio-button-groups</a></li>
</ul>
<ul>
<li><p>（前提）以下のように <code>__init__.py</code> が記述してあるとする．ここでは順番のシャッフルうんぬんについては捨象する．</p>
<div class="accordion accordionClose"><div class="accordionButton"><div class="accordionTitle"><code>__init__.py</code></div><div class="accordionSpinnerBox"><div class="accordionSpinner"></div></div></div><div class="accordionContent">
<pre><code class="lang-python"><span class="hljs-keyword">from</span> otree.api <span class="hljs-keyword">import</span> *

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span>(<span class="hljs-params">BaseConstants</span>):</span>
    NAME_IN_URL = <span class="hljs-string">&apos;survey&apos;</span>
    PLAYERS_PER_GROUP = <span class="hljs-literal">None</span>
    NUM_ROUNDS = <span class="hljs-number">1</span>

    materials_gentrust = {
        <span class="hljs-string">&quot;field&quot;</span>: models.IntegerField,
        <span class="hljs-string">&quot;opts&quot;</span>: [
            [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Strongly Disagree&quot;</span>],
            [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Disagree&quot;</span>],
            [<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Neutral&quot;</span>],
            [<span class="hljs-number">4</span>, <span class="hljs-string">&quot;Agree&quot;</span>],
            [<span class="hljs-number">5</span>, <span class="hljs-string">&quot;Strongly Agree&quot;</span>]
        ],
        <span class="hljs-string">&quot;items&quot;</span>: {
            <span class="hljs-string">&quot;gentrust1&quot;</span>: <span class="hljs-string">&quot;Most people are basically honest.&quot;</span>,
            <span class="hljs-string">&quot;gentrust2&quot;</span>: <span class="hljs-string">&quot;Most people are trustworthy.&quot;</span>,
            <span class="hljs-string">&quot;gentrust3&quot;</span>: <span class="hljs-string">&quot;Most people are basically good and kind.&quot;</span>,
            <span class="hljs-string">&quot;gentrust4&quot;</span>: <span class="hljs-string">&quot;Most people are trustful of others.&quot;</span>,
            <span class="hljs-string">&quot;gentrust5&quot;</span>: <span class="hljs-string">&quot;I am trustful.&quot;</span>,
            <span class="hljs-string">&quot;gentrust6&quot;</span>: <span class="hljs-string">&quot;Most people will respond in kind when they are trusted by others.&quot;</span>
        }
    }

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Subsession</span>(<span class="hljs-params">BaseSubsession</span>):</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Group</span>(<span class="hljs-params">BaseGroup</span>):</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">BasePlayer</span>):</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>].items():
    <span class="hljs-built_in">setattr</span>(
        Player,
        k,
        C.materials_gentrust[<span class="hljs-string">&quot;field&quot;</span>](
            label = v,
            choices = C.materials_gentrust[<span class="hljs-string">&quot;opts&quot;</span>],
            widget = widgets.RadioSelectHorizontal
        )
    )

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Survey1</span>(<span class="hljs-params">Page</span>):</span>
    template_name = __name__ + <span class="hljs-string">&quot;/GenTrust.html&quot;</span>
    form_model = <span class="hljs-string">&quot;player&quot;</span>
    form_fields = [*C.materials_gentrust[<span class="hljs-string">&quot;items&quot;</span>].keys()]    <span class="hljs-comment">## とりあえず入力フォームの順番は固定のままにしておく．</span>

page_sequence = [Survey1]
</code></pre>
</div></div>
</li>
</ul>
<ul>
<li><p>テンプレートタグ <code>{{ formfields }}</code> を使うと以下のような（ダサい）スタイルとなる．</p>
<p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="result" data-slug-hash="xxWGjOM" data-editable="true" data-user="yshimod" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
    <span>See the Pen <a href="https://codepen.io/yshimod/pen/xxWGjOM" target="_blank">
    oTree day7-0</a> by yshimod (<a href="https://codepen.io/yshimod" target="_blank">@yshimod</a>)
    on <a href="https://codepen.io" target="_blank">CodePen</a>.</span>
</p>


</li>
</ul>
<ul>
<li><p>まず， Bootstrap のドキュメントからコードの例をコピーして，テンプレートに貼り付ける．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-group&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;group&quot;</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;Basic radio toggle button group&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;btnradio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btnradio1&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">checked</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;btnradio1&quot;</span>&gt;</span>Radio 1<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;btnradio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btnradio2&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;btnradio2&quot;</span>&gt;</span>Radio 2<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;btnradio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btnradio3&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;btnradio3&quot;</span>&gt;</span>Radio 3<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="result" data-slug-hash="QWmbrKM" data-editable="true" data-user="yshimod" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
    <span>See the Pen <a href="https://codepen.io/yshimod/pen/QWmbrKM" target="_blank">
    oTree day7-1</a> by yshimod (<a href="https://codepen.io/yshimod" target="_blank">@yshimod</a>)
    on <a href="https://codepen.io" target="_blank">CodePen</a>.</span>
</p>


</li>
</ul>
<ul>
<li><p>外側の <code>&lt;div&gt;</code> 要素:</p>
<ul>
<li><p><code>class</code> 属性の <code>btn-group</code> は Bootstrap が定義したもの．</p>
<ul>
<li>子要素の <code>class=&quot;btn&quot;</code> であるものを <code>&lt;div class=&quot;btn-group&quot;&gt;</code> で囲む．</li>
</ul>
</li>
<li><p><code>role</code> 属性と <code>aria-*</code> 属性は WAI-ARIA （支援技術を利用するためのルール） のためのもの．</p>
<ul>
<li><p>（少なくともラボで実験を実施する場合は）属性ごと消してしまっても良い．</p>
</li>
<li><p><a href="https://developer.mozilla.org/ja/docs/Learn/Accessibility/WAI-ARIA_basics" target="_blank">https://developer.mozilla.org/ja/docs/Learn/Accessibility/WAI-ARIA_basics</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>内側の <code>&lt;input&gt;</code> 要素:</p>
<ul>
<li><p>（HTMLの機能） <code>type</code> 属性を <code>radio</code> にすることによって， <code>&lt;input&gt;</code> 要素がラジオボタンとして機能する．</p>
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/HTML/Element/input/radio" target="_blank">https://developer.mozilla.org/ja/docs/Web/HTML/Element/input/radio</a></li>
</ul>
</li>
<li><p>（HTMLの機能） <code>name</code> 属性の値はフィールド名にする．選択肢の数だけ <code>&lt;input&gt;</code> 要素があるが，すべて同じフィールド名にする．</p>
<ul>
<li>とりあえず <code>name=&quot;gentrust1&quot;</code> としておく．</li>
</ul>
</li>
<li><p>（HTMLの機能） <code>name</code> 属性とは異なり， <code>id</code> 属性の値は <code>&lt;input&gt;</code> 要素ごと区別させなければならない．</p>
<ul>
<li><p><code>&lt;input&gt;</code> 要素の <code>id</code> は <code>&lt;label&gt;</code> 要素との紐付けのために必要なものなので，その値自体は，ユニークでさえあれば，何でも良い．</p>
</li>
<li><p>oTree の流儀（というより Django の流儀を引き継いでいるのだが）としては，フィールド名の頭に <code>id_</code> をつけ，その上で枝番を（0から）つける．ただし，このルールにしたがう必要はない．</p>
</li>
<li><p>とりあえず <code>name=&quot;id_gentrust1-0&quot;</code> としておく．</p>
</li>
</ul>
</li>
<li><p>（HTMLの機能） <code>checked</code> 属性が追加されていると，そのラジオボタンが選択されていることを表す．</p>
<ul>
<li><p>テンプレートにおいて <code>checked</code> 属性を記述してしまうと，デフォルトでそのボタンが選択されてしまう．</p>
</li>
<li><p>論理属性なので，値を渡す必要はない． <code>checked=&quot;&quot;</code> と記述してあっても， <code>checked</code> 属性自体が存在するため，そのラジオボタンが選択されていることになる．</p>
</li>
<li><p>今回は，デフォルトでいずれかのラジオボタンが選択されている必要がないため， <code>checked</code> 属性は消しておく．</p>
</li>
</ul>
</li>
<li><p>（HTMLの機能） あるラジオボタンが選択された状態でフォームが送信されると，そのラジオボタン <code>value</code> 属性の値が送信される．</p>
<ul>
<li><p>陽に <code>value</code> 属性を指定しない場合は，デフォルトで <code>&quot;on&quot;</code> なる文字列となる．</p>
</li>
<li><p>コピペした Bootstrap のコードには <code>value</code> 属性が記述されていないため，自分で追加しなければならない．</p>
</li>
<li><p>データモデルの定義をしたときに <code>choices</code> を記述している場合，その値と一致しなければならない．</p>
</li>
<li><p>とりあえず，値を直書きしておく．</p>
</li>
</ul>
</li>
<li><p>（HTMLの機能） 必須回答にする場合（データモデルの定義で <code>blank=True</code> としていない場合）， <code>required</code> 属性を追加しておく．</p>
<ul>
<li><p>複数ある選択肢のうちの一つにだけ <code>required</code> 属性が追加されていれば， <code>name</code> 属性が同じ値である <code>&lt;input&gt;</code> 要素（ラジオボタン）の1つが選択されていないとフォームの送信ができない．</p>
</li>
<li><p>↑ このような仕様ではあるが，保守性のために，すべての <code>&lt;input&gt;</code> 要素に <code>required</code> 属性を追加しておいた方が良い．</p>
</li>
<li><p>論理属性なので，値を渡す必要はない．</p>
</li>
</ul>
</li>
<li><p>（HTMLの機能） 一般論として， <code>autocomplete</code> 属性の値は <code>&quot;off&quot;</code> にしておいたほうが良い．さもないと， Firefox だけはラジオボタンの選択を維持してしまう．</p>
<ul>
<li><p>しかしながら， oTree 本体でフォーム全体（コンテンツブロック全体）に対して <code>autocomplete=&quot;off&quot;</code> としてあるため，自分で陽に書く必要はない．</p>
</li>
<li><p>とは言え念の為，サンプルのまま残しておく．</p>
</li>
</ul>
</li>
<li><p>（Bootstrapの機能） <code>class</code> 属性の <code>&quot;btn-check&quot;</code> は Bootstrap が定義したクラス名．</p>
<ul>
<li><p><a href="https://getbootstrap.jp/docs/5.0/forms/checks-radios/#radio-toggle-buttons" target="_blank">https://getbootstrap.jp/docs/5.0/forms/checks-radios/#radio-toggle-buttons</a></p>
</li>
<li><p><code>&lt;label class=&quot;btn&quot;&gt;</code> 要素とセットで機能する．</p>
</li>
<li><p>サンプルのままにしておく．</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>内側の <code>&lt;label&gt;</code> 要素:</p>
<ul>
<li><p>（HTMLの機能） <code>for</code> 属性を対応する <code>&lt;input&gt;</code> 要素の <code>id</code> と一致させる．</p>
</li>
<li><p>（HTMLの機能） ラベルとして表示するテキストを <code>&lt;label&gt;</code> の子要素に書く．</p>
<ul>
<li>とりあえず選択肢のラベルを直書きする．</li>
</ul>
</li>
<li><p>（Bootstrapの機能） <code>class</code> 属性の <code>&quot;btn btn-outline-primary&quot;</code> は Bootstrap が定義したもの．2つ目のクラス <code>btn-outline-primary</code> は modifier と呼ばれるもので，base class である <code>btn</code> を修飾する．</p>
<ul>
<li><p>たとえば <code>btn-outline-primary</code> の代わりに <code>btn-outline-danger</code> とすると，ボタンの色が赤色になる．</p>
</li>
<li><p>たとえばボタンのサイズを大きくしたい場合は，更に <code>btn-lg</code> クラスも適用する．つまり， <code>class=&quot;btn btn-outline-primary btn-lg&quot;</code> とする．</p>
</li>
<li><p><a href="https://getbootstrap.jp/docs/5.0/components/buttons/" target="_blank">https://getbootstrap.jp/docs/5.0/components/buttons/</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>とりあえず選択肢ごと変わる部分の記述を直書きした状態は以下の通り．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-group&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 最初の3つだけ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-0&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-0&quot;</span>&gt;</span>Strongly Disagree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-1&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-1&quot;</span>&gt;</span>Disagree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-2&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-2&quot;</span>&gt;</span>Neutral<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
</ul>
<ul>
<li><p>（oTreeの機能） 選択肢の繰り返しの部分は <code>{{ for }}</code> ループを使って記述する．</p>
<ul>
<li><p>（前提） テンプレートで展開される <code>{{ C.materials_gentrust.opts }}</code> の正体は以下のリスト．</p>
<pre><code class="lang-python">[
  [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Strongly Disagree&quot;</span>],
  [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Disagree&quot;</span>],
  [<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Neutral&quot;</span>],
  [<span class="hljs-number">4</span>, <span class="hljs-string">&quot;Agree&quot;</span>],
  [<span class="hljs-number">5</span>, <span class="hljs-string">&quot;Strongly Agree&quot;</span>]
]
</code></pre>
</li>
<li><p>データモデルの定義の <code>choices</code> にこのリストを渡しているため，フォームで送信するべき値（ <code>&lt;input&gt;</code> 要素の <code>value</code> 属性の値）は，リストの各要素の0番目の要素（つまり <code>1</code>， <code>2</code>， <code>3</code>， <code>4</code>， <code>5</code> ）．</p>
</li>
<li><p>たとえば <code>{{ C.materials_gentrust.opts.1.1 }}</code> は <code>Disagree</code> が展開される．</p>
</li>
<li><p>テンプレートで <code>{{ for v in C.materials_gentrust.opts }}</code> と書くと，ループの中で...</p>
<ul>
<li><p><code>{{ v.0 }}</code> は <code>1</code>， <code>2</code>， <code>3</code>， <code>4</code>， <code>5</code> が展開される．</p>
</li>
<li><p><code>{{ v.1 }}</code> は <code>Strongly Disagree</code>， <code>Disagree</code>， <code>Neutral</code>， <code>Agree</code>， <code>Strongly Agree</code> が展開される．</p>
</li>
<li><p><code>{{ forloop.counter }}</code> は <code>1</code>， <code>2</code>， <code>3</code>， <code>4</code>， <code>5</code> が展開される．</p>
</li>
<li><p><code>{{ forloop.counter0 }}</code> は <code>0</code>， <code>1</code>， <code>2</code>， <code>3</code>， <code>4</code> が展開される．</p>
</li>
</ul>
</li>
<li><p>ある一つの質問項目の5つの選択肢は， <code>{{ for }}</code> ループを使って以下のように記述すれば良い．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-group&quot;</span>&gt;</span>
  {{ for v in C.materials_gentrust.opts }}
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-{{ forloop.counter0 }}&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ v.0 }}&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-{{ forloop.counter0 }}&quot;</span>&gt;</span>{{ v.1 }}<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  {{ endfor }}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
</ul>
<p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="result" data-slug-hash="oNqXdzr" data-editable="true" data-user="yshimod" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
    <span>See the Pen <a href="https://codepen.io/yshimod/pen/oNqXdzr" target="_blank">
    oTree day7-2</a> by yshimod (<a href="https://codepen.io/yshimod" target="_blank">@yshimod</a>)
    on <a href="https://codepen.io" target="_blank">CodePen</a>.</span>
</p>


</li>
</ul>
<ul>
<li><p>さらに質問項目の繰り返しの部分も <code>{{ for }}</code> ループを使って記述する．</p>
<ul>
<li><p>（前提） <code>form_fields = [&apos;gentrust1&apos;, &apos;gentrust2&apos;, &apos;gentrust3&apos;, &apos;gentrust4&apos;, &apos;gentrust5&apos;, &apos;gentrust6&apos;]</code> と指定してある．</p>
</li>
<li><p>（oTreeの機能） テンプレートで <code>{{ for eachfield in form }}</code> と書くと，ループの中で...</p>
<ul>
<li><p><code>{{ eachfield.label }}</code> は，<br><code>&lt;label for=&quot;id_gentrust1&quot;&gt;Most people are basically honest.&lt;/label&gt;</code>，<br><code>&lt;label for=&quot;id_gentrust2&quot;&gt;Most people are trustworthy.&lt;/label&gt;</code>，<br>...，<br><code>&lt;label for=&quot;id_gentrust6&quot;&gt;Most people will respond in kind when they are trusted by others.&lt;/label&gt;</code><br>が展開される．</p>
<ul>
<li><p>ラジオボタンを生成する目的において <code>for</code> 属性は不要であるが，あっても問題なく動くため，このまま <code>&lt;p&gt;</code> タグで包んで使う．</p>
</li>
<li><p><code>&lt;label&gt;</code> タグを生成せずに，単なるテキストだけ展開してくれれば幾分便利なのだが， oTree の著者は気が利かない．</p>
</li>
</ul>
</li>
<li><p><code>{{ eachfield.name }}</code> は， <code>gentrust1</code>， <code>gentrust2</code>， ...， <code>gentrust6</code> が展開される．</p>
</li>
<li><p><code>{{ eachfield.id }}</code> は， <code>id_gentrust1</code>， <code>id_gentrust2</code>， ...， <code>id_gentrust6</code> が展開される．</p>
</li>
<li><p><code>{{ eachfield }}</code> は，以下のように一つの質問項目のすべての選択肢が展開される（ただしデータモデルの定義で <code>widget = widgets.RadioSelectHorizontal</code> と指定していることを前提）．</p>
<div class="accordion accordionClose"><div class="accordionButton"><div class="accordionTitle"><code>{{ eachfield }}</code>で展開される HTML</div><div class="accordionSpinnerBox"><div class="accordionSpinner"></div></div></div><div class="accordionContent">
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-0&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-0&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Strongly Disagree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Disagree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-2&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Neutral<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-3&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;4&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-3&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Agree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-4&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-4&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Strongly Agree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</div></div>
<ul>
<li><p>選択肢を一つずつ取り出すことも可能． <code>{{ eachfield.0 }}</code> （ <code>{{ for eachopt in eachfield }}</code> の0番目）は</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_gentrust1-0&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gentrust1&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>
</code></pre>
<p><code>{{ eachfield.0.label }}</code> は</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_gentrust1-0&quot;</span>&gt;</span>Strongly Disagree<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
</code></pre>
<p><code>{{ eachfield.0.label }}</code> は <code>id_gentrust1-0</code> が，それぞれ展開される．</p>
</li>
<li><p>↑ を見れば分かるように，選択肢を <code>{{ form }}</code> の中から取り出して展開しても（Bootstrapを使う分には）使い勝手が悪い．</p>
</li>
<li><p>ゆえに，選択肢を <code>{{ for }}</code> ループで作るときには，素材を直接 <code>C</code> クラスから取り出す（あるいは <code>vars_for_template()</code> で渡す ）方が良い．</p>
</li>
<li><p><code>{{ eachfield.0.label }}</code> で <code>&lt;label&gt;</code> タグを生成せずに，単なるテキストだけ展開してくれれば幾分便利なのだが， oTree の著者は気が利かない．</p>
</li>
</ul>
</li>
<li><p>詳細は <a href="otree_ref/templatefile.html#form-オブジェクト">こちら</a> ．</p>
</li>
</ul>
</li>
<li><p>（oTreeの機能） 入力フォームの検証を oTree サーバー側でも行うとき（たとえば正答の判定を行う場合など）， <code>{{ formfield_errors フィールド名 }}</code> を記述しておけば，検証に引っかかった場合にエラーメッセージが <code>&lt;div class=&quot;form-control-errors&quot;&gt;ここにエラーメッセージ&lt;/div&gt;</code> として展開される．</p>
<ul>
<li><p><code>{{ for eachfield in form }}</code> のループの中では <code>{{ formfield_errors eachfield.name }}</code> と記述しておけば良い．</p>
</li>
<li><p>HTML タグの直書きで実装したい場合は，たとえば以下のように記述すれば良い．</p>
<pre><code class="lang-html">{{ if eachfield.errors }}
  <span class="hljs-comment">&lt;!-- 検証に引っかかった場合にのみ以下の要素が展開される --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>もう一度確認してください．<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{{ endif }}
</code></pre>
</li>
</ul>
</li>
<li><p>質問文と選択肢のみを <code>{{ for }}</code> ループで質問項目の数だけ作るには以下のように記述すれば良い．</p>
<pre><code class="lang-html">{{ for eachfield in form }}
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ eachfield.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-group&quot;</span>&gt;</span>
      {{ for v in C.materials_gentrust.opts }}
          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;{{ eachfield.name }}&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;{{ eachfield.id }}-{{ forloop.counter0 }}&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ v.0 }}&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;{{ eachfield.id }}-{{ forloop.counter0 }}&quot;</span>&gt;</span>{{ v.1 }}<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      {{ endfor }}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  {{ formfield_errors eachfield.name }}
{{ endfor }}
</code></pre>
</li>
</ul>
<p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="result" data-slug-hash="qBodYqG" data-editable="true" data-user="yshimod" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
    <span>See the Pen <a href="https://codepen.io/yshimod/pen/qBodYqG" target="_blank">
    oTree day7-3</a> by yshimod (<a href="https://codepen.io/yshimod" target="_blank">@yshimod</a>)
    on <a href="https://codepen.io" target="_blank">CodePen</a>.</span>
</p>


</li>
</ul>
<ul>
<li><p>（Bootstrapの機能） 質問項目同士の間隔を離らかすには，質問項目全体を <code>&lt;div&gt;</code> 要素で包み，その <code>class</code> 属性に <code>my-5</code> などを加える．</p>
<ul>
<li><p><a href="https://getbootstrap.jp/docs/5.0/utilities/spacing" target="_blank">https://getbootstrap.jp/docs/5.0/utilities/spacing</a></p>
</li>
<li><p><code>my-5</code> は <code>m</code>argin の <code>y</code>方向を，size <code>5</code> の距離にすることを意味する（「size」は Bootstrap のドキュメントを参照のこと）．</p>
</li>
<li><p>細かく調整したい場合は，Bootstrapを使わずに直接 <code>styles=&quot;margin: 10px auto;&quot;</code> などと指定する．</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>（Bootstrapの機能） 一つの質問項目を線で囲むには， Card を使ってみる．</p>
<ul>
<li><p><a href="https://getbootstrap.jp/docs/5.0/components/card/" target="_blank">https://getbootstrap.jp/docs/5.0/components/card/</a></p>
</li>
<li><p>ドキュメントのコードの例:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 18rem;&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-img-top&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-body&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-title&quot;</span>&gt;</span>Card title<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-text&quot;</span>&gt;</span>Some quick example text to build on the card title and make up the bulk of the card&apos;s content.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>Go somewhere<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
<li><p>不要な要素を消すと以下のようになる．コメントアウトしてある部分に要素を挿入する．</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-body&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-title&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- ここにタイトル --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-text&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- ここに質問文 --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- ここに選択肢要素 --&gt;</span>
      <span class="hljs-comment">&lt;!-- ここにエラーメッセージ要素 --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
<li><p>たとえば <code>&lt;h5 class=&quot;card-title&quot;&gt;</code> 要素で，何番目の質問であるか（ <code>{{ forloop.counter }}</code> ）を表示してみる．</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>結局，（ページクラスで直接読み込む）テンプレートは以下のように記述すれば良い．</p>
<pre><code class="lang-html">{{ block title }}
    Survey
{{ endblock }}
{{ block content }}
    {{ for eachfield in form }}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card my-5&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-body&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-title&quot;</span>&gt;</span>{{ forloop.counter }}<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-text&quot;</span>&gt;</span>{{ eachfield.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-group&quot;</span>&gt;</span>
                    {{ for v in C.materials_gentrust.opts }}
                        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-check&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;{{ eachfield.name }}&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;{{ eachfield.id }}-{{ forloop.counter0 }}&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ v.0 }}&quot;</span> <span class="hljs-attr">required</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-outline-primary&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;{{ eachfield.id }}-{{ forloop.counter0 }}&quot;</span>&gt;</span>{{ v.1 }}<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                    {{ endfor }}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                {{ formfield_errors eachfield.name }}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {{ endfor }}
    {{ next_button }}
{{ endblock }}
</code></pre>
<p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="result" data-slug-hash="ZExGoLR" data-editable="true" data-user="yshimod" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
    <span>See the Pen <a href="https://codepen.io/yshimod/pen/ZExGoLR" target="_blank">
    oTree day7-4</a> by yshimod (<a href="https://codepen.io/yshimod" target="_blank">@yshimod</a>)
    on <a href="https://codepen.io" target="_blank">CodePen</a>.</span>
</p>



</li>
</ul>
<p class="ytubevideo"><iframe width="560" height="315" src="https://www.youtube.com/embed/deJDSzgFY68?rel=0&amp;enablejsapi=1&amp;origin=https://yshimod.github.io/" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>


<ul>
<li><p>勉強会当日は完成したコードを見ながら説明しましたが，改めて振り返るとあまりに説明を端折りすぎていたように思えたので，このページでは， Bootstrap のドキュメントからコードをコピーしてきたところから順を追ってテンプレートを書く方法を説明しています．</p>
</li>
<li><p>Bootstrap の使い方については様々な書籍や野良のWebページが存在しているので，そちらを参照すると良いでしょう．</p>
<ul>
<li><p>注意点は， oTree 5 のデフォルトで読み込んでいる Bootstrap のバージョンが 5.0.1 である点です． Bootstrap のバージョン4と5では，仕様に大きな差異があります．</p>
</li>
<li><p>野良のWebページのコードの例をよく見ずにコピペして使おうとしたとき，実は古いバージョンのコードであり自分のプロジェクトでは上手く機能しない，ということはありえそうです．</p>
</li>
<li><p>oTree 3 （3.4.0） では Bootstrap のバージョン 4.0.0 をデフォルトで読み込んでいるため， oTree 3 で書かれたコードで Bootstrap を駆使していた場合， oTree 5 でそのまま動かそうとしても意図した挙動にならないかもしれません．<br><a href="https://otree.readthedocs.io/en/latest/misc/otreelite.html#bootstrap" target="_blank">https://otree.readthedocs.io/en/latest/misc/otreelite.html#bootstrap</a></p>
</li>
</ul>
</li>
</ul>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>


                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="day6.html" class="navigation navigation-prev " aria-label="Previous page: 第6回">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="day8.html" class="navigation navigation-next " aria-label="Next page: 第8回">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"第7回","level":"1.1.7","depth":2,"next":{"title":"第8回","level":"1.1.8","depth":2,"path":"day8.md","ref":"day8.md","articles":[]},"previous":{"title":"第6回","level":"1.1.6","depth":2,"path":"day6.md","ref":"day6.md","articles":[]},"dir":"ltr"},"config":{"plugins":["page-toc","sitemap","@honkit/honkit-plugin-ga","accordion"],"root":"./","styles":{"website":"styles/website.css"},"pluginsConfig":{"accordion":{},"search":{},"page-toc":{"selector":".markdown-section h2, .markdown-section h3, .markdown-section h4","position":"before-first","showByDefault":true},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"url":"https://yshimod.github.io","pathSuffix":"/otree5-seminar/"},"@honkit/honkit-plugin-ga":{},"ga":{"trackingID":"G-6WR8KXSQYF"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"oTree 5 勉強会","language":"ja","gitbook":"*","description":""},"file":{"path":"day7.md","mtime":"2022-07-12T08:48:29.428Z","type":"markdown"},"gitbook":{"version":"3.7.4","time":"2022-07-13T08:04:07.253Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="gitbook/@honkit/honkit-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

